plugins {
	id 'org.hidetake.ssh' version '2.7.0'
}

apply plugin: 'java'

repositories {
	mavenCentral()
}

dependencies {
	testCompile 'junit:junit:4.12'
	testCompile 'org.assertj:assertj-core:3.6.1'
}

ssh.settings {
	knownHosts = allowAnyHosts
}

remotes {
	localhost {
		role 'local'
		host = 'localhost'
		user = project.ext['SSH_USERNAME']
		identity = project.ext['SSH_KEY']
		passphrase = project.ext['SSH_PASSPHRASE']
	}
}

task integrationTest() << {
	println "integration test start"
	for(int i=0;i<5;i++) {
		Thread.sleep(1000L)
		def d = new Date()
		println "itest $i - $d"
	}
	println "Integration Test Done"
}

task stageDocs() << {
	println "stage docs start"
	for(int i=0;i<5;i++) {
		Thread.sleep(1000L)
		def d = new Date()
		println "stage docs $i - $d"
	}
	println "stage docs Done"
}

task deploy() << {
	ssh.run {
		session(remotes.localhost) {
			put from: files('settings.gradle'), into: '/tmp/'
		}
	}
}

check.dependsOn integrationTest